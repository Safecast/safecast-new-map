This patch adds full pagination UI with page buttons to both admin pages.

INSTRUCTIONS:
1. This patch modifies safecast-new-map.go to add:
   - Page variables (page, offset, totalCount, totalPages)
   - Pagination UI with Previous/Next buttons and page numbers
   - Updates to both uploads and tracks handlers

2. Apply with:
   cd /home/rob/Documents/Safecast/safecast-new-map
   patch -p1 < pagination_ui.patch

3. Or manually apply the changes shown below.

CHANGES TO adminUploadsHandler:
================================

CHANGE 1: Update limit and add pagination variables (around line 4778)
-----------------------------------------------------------------------
REPLACE:
	// Get limit parameter
	limit := 100
	if limitStr := r.URL.Query().Get("limit"); limitStr != "" {
		if parsedLimit, err := strconv.Atoi(limitStr); err == nil && parsedLimit > 0 {
			limit = parsedLimit
		}
	}

	// Get user_id filter parameter
	userID := r.URL.Query().Get("user_id")

	ctx := r.Context()
	uploads, err := db.GetUploads(ctx, limit, userID)

WITH:
	// Get limit parameter (page size)
	limit := 500 // Default to 500 per page
	if limitStr := r.URL.Query().Get("limit"); limitStr != "" {
		if parsedLimit, err := strconv.Atoi(limitStr); err == nil && parsedLimit > 0 {
			limit = parsedLimit
		}
	}

	// Get page parameter
	page := 1
	if pageStr := r.URL.Query().Get("page"); pageStr != "" {
		if parsedPage, err := strconv.Atoi(pageStr); err == nil && parsedPage > 0 {
			page = parsedPage
		}
	}

	// Calculate offset
	offset := (page - 1) * limit

	// Get user_id filter parameter
	userID := r.URL.Query().Get("user_id")

	ctx := r.Context()

	// Get total count for pagination
	totalCount, err := db.CountUploads(ctx, userID)
	if err != nil {
		log.Printf("Error counting uploads: %v", err)
		http.Error(w, "Failed to count uploads", http.StatusInternalServerError)
		return
	}

	// Calculate total pages
	totalPages := (totalCount + limit - 1) / limit
	if totalPages < 1 {
		totalPages = 1
	}

	// Fetch current page of uploads
	uploads, err := db.GetUploadsPaginated(ctx, limit, offset, userID)


CHANGE 2: Update summary display (around line 4926)
---------------------------------------------------
REPLACE:
	<div class="summary">
		<strong>Total Uploads:</strong> ` + strconv.Itoa(len(uploads)) + ` files (showing up to ` + strconv.Itoa(limit) + `)
		<span style="margin-left: 20px;">
			<label for="limitSelect"><strong>Show:</strong></label>

WITH:
	<div class="summary">
		<strong>Total Uploads:</strong> ` + strconv.Itoa(totalCount) + ` files
		<span style="margin-left: 20px;">
			<strong>Page ` + strconv.Itoa(page) + ` of ` + strconv.Itoa(totalPages) + `</strong>
			(showing ` + strconv.Itoa(len(uploads)) + ` uploads)
		</span>
		<span style="margin-left: 20px;">
			<label for="limitSelect"><strong>Per page:</strong></label>


CHANGE 3: Update page size options (remove "All" option, add 250)
-----------------------------------------------------------------
REPLACE the limit select options to include 250 and remove the "All" 10000+ option.


CHANGE 4: Add pagination controls after table (around line 5056, after </table>)
--------------------------------------------------------------------------------
ADD THIS CODE after `html += "</table>"` and before `html += "<script>"`:

	// Add pagination controls
	html += `
	<div class="pagination">
		<div class="pagination-info">
			Showing ` + strconv.Itoa(offset+1) + ` to ` + strconv.Itoa(offset+len(uploads)) + ` of ` + strconv.Itoa(totalCount) + ` uploads
		</div>
		<div class="pagination-controls">`

	// Previous button
	if page > 1 {
		prevURL := "?password=" + password + "&page=" + strconv.Itoa(page-1) + "&limit=" + strconv.Itoa(limit)
		if userID != "" {
			prevURL += "&user_id=" + userID
		}
		html += `<a href="` + prevURL + `" class="page-btn">« Previous</a>`
	} else {
		html += `<span class="page-btn disabled">« Previous</span>`
	}

	// Page numbers - show first, last, and 5 pages around current
	startPage := page - 2
	if startPage < 1 {
		startPage = 1
	}
	endPage := startPage + 4
	if endPage > totalPages {
		endPage = totalPages
		startPage = endPage - 4
		if startPage < 1 {
			startPage = 1
		}
	}

	// First page
	if startPage > 1 {
		url := "?password=" + password + "&page=1&limit=" + strconv.Itoa(limit)
		if userID != "" {
			url += "&user_id=" + userID
		}
		html += `<a href="` + url + `" class="page-btn">1</a>`
		if startPage > 2 {
			html += `<span class="page-btn disabled">...</span>`
		}
	}

	// Page range around current
	for i := startPage; i <= endPage; i++ {
		if i == page {
			html += `<span class="page-btn active">` + strconv.Itoa(i) + `</span>`
		} else {
			url := "?password=" + password + "&page=" + strconv.Itoa(i) + "&limit=" + strconv.Itoa(limit)
			if userID != "" {
				url += "&user_id=" + userID
			}
			html += `<a href="` + url + `" class="page-btn">` + strconv.Itoa(i) + `</a>`
		}
	}

	// Last page
	if endPage < totalPages {
		if endPage < totalPages-1 {
			html += `<span class="page-btn disabled">...</span>`
		}
		url := "?password=" + password + "&page=" + strconv.Itoa(totalPages) + "&limit=" + strconv.Itoa(limit)
		if userID != "" {
			url += "&user_id=" + userID
		}
		html += `<a href="` + url + `" class="page-btn">` + strconv.Itoa(totalPages) + `</a>`
	}

	// Next button
	if page < totalPages {
		nextURL := "?password=" + password + "&page=" + strconv.Itoa(page+1) + "&limit=" + strconv.Itoa(limit)
		if userID != "" {
			nextURL += "&user_id=" + userID
		}
		html += `<a href="` + nextURL + `" class="page-btn">Next »</a>`
	} else {
		html += `<span class="page-btn disabled">Next »</span>`
	}

	html += `
		</div>
	</div>


CHANGE 5: Update changeLimit() JavaScript function (around line 5232)
--------------------------------------------------------------------
REPLACE:
		function changeLimit() {
			const limit = document.getElementById('limitSelect').value;
			const url = new URL(window.location.href);
			url.searchParams.set('limit', limit);
			window.location.href = url.toString();
		}

WITH:
		function changeLimit() {
			const limit = document.getElementById('limitSelect').value;
			const url = new URL(window.location.href);
			url.searchParams.set('limit', limit);
			url.searchParams.set('page', '1');  // Reset to page 1 when changing limit
			window.location.href = url.toString();
		}


CHANGES TO adminTracksHandler:
===============================

Apply similar changes to adminTracksHandler (around line 5903):

CHANGE 1: Add pagination variables
-----------------------------------
REPLACE:
	// Get limit parameter
	limit := 1000
	if limitStr := r.URL.Query().Get("limit"); limitStr != "" {
		if parsedLimit, err := strconv.Atoi(limitStr); err == nil && parsedLimit > 0 {
			limit = parsedLimit
		}
	}

	ctx := r.Context()

WITH:
	// Get limit parameter (page size)
	limit := 500 // Default to 500 per page
	if limitStr := r.URL.Query().Get("limit"); limitStr != "" {
		if parsedLimit, err := strconv.Atoi(limitStr); err == nil && parsedLimit > 0 {
			limit = parsedLimit
		}
	}

	// Get page parameter
	page := 1
	if pageStr := r.URL.Query().Get("page"); pageStr != "" {
		if parsedPage, err := strconv.Atoi(pageStr); err == nil && parsedPage > 0 {
			page = parsedPage
		}
	}

	// Calculate offset
	offset := (page - 1) * limit

	ctx := r.Context()

	// Get total count for pagination
	var totalCount int
	countQuery := "SELECT COUNT(*) FROM track_statistics"
	if err := db.DB.QueryRowContext(ctx, countQuery).Scan(&totalCount); err != nil {
		log.Printf("Error counting tracks: %v", err)
		http.Error(w, "Failed to count tracks", http.StatusInternalServerError)
		return
	}

	// Calculate total pages
	totalPages := (totalCount + limit - 1) / limit
	if totalPages < 1 {
		totalPages = 1
	}


CHANGE 2: Update queries to use OFFSET
---------------------------------------
REPLACE both queries (SQLite and PostgreSQL) to add OFFSET:

SQLite:
	query := `
		SELECT
			trackID,
			marker_count,
			first_date,
			last_date,
			spectra_count
		FROM track_statistics
		ORDER BY last_date DESC
		LIMIT ? OFFSET ?
	`
	args := []interface{}{limit, offset}

PostgreSQL:
	query := `
		SELECT
			trackID,
			marker_count,
			first_date,
			last_date,
			spectra_count
		FROM track_statistics
		ORDER BY last_date DESC
		LIMIT $1 OFFSET $2
	`
	args := []interface{}{limit, offset}


CHANGE 3: Add pagination UI after tracks table
----------------------------------------------
Add similar pagination HTML after the tracks table (similar to uploads, but without userID parameter).


TESTING:
========
After applying the patch:

1. Rebuild:
   go build -o safecast-new-map safecast-new-map.go

2. Restart server:
   ./safecast-new-map -safecast-realtime -admin-password test123

3. Test uploads pagination:
   http://localhost:8765/api/admin/uploads?password=test123

4. Test tracks pagination:
   http://localhost:8765/api/admin/tracks?password=test123

You should see:
- "Page 1 of 17" indicator
- Previous/Next buttons (Previous disabled on page 1)
- Page numbers (1, 2, 3, 4, 5)
- ... indicator if there are many pages
- All buttons clickable and working
